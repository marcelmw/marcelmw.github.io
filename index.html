<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Itaucard.Dash</title>
	<!--<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKXW59nZs0VU_GjaizM0YzKQ6HM87mrzs&sensor=true"></script>-->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.min.js"></script>	

	<link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
	<script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha1.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/enc-base64-min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
	<script type="text/javascript">
		var apiSecret;
       	var stUserName = "marcel.watanabe:Itau";
		var nonce;
		var timestamp;
		var digest;
		var encNonce;
		$(document).ready(function() {
			apiSecret = document.location.search.substring(1);
			$('input#btLoad').click(function() {
				nonce = getNonce();
				timestamp = new Date().toISOString().split(".")[0]+"Z";
				digest = getDigest();
				encNonce = btoa(nonce);
				
				$.ajax({
					url:"https://api.omniture.com/admin/1.3/rest/?method=Report.GetRealTimeReport",
					type:"POST",
					data: {
						"reportDescription":{
							"reportSuiteID":"it-receptivo",
							"metrics":[
								{
									"id":"event4"
								}
							],
							"periodMinutes": 20,
							"periodCount": 20,
							"periodOffset": 10
						}
					},
					headers: {"X-WSSE":"UsernameToken Username=\"" + stUserName + "\", PasswordDigest=\"" + digest + "\", Nonce=\"" + encNonce + "\", Created=\"" + timestamp + "\""}
				})
				.done(function( data ) {
					if ( console && console.log ) {
						console.log( "Sample of data:", data );
					}
					
					//chart
					buildChart(data);
					
				});
			});
		});
		
		function getNonce() {
			var nonce = "";
			var chars = "0123456789abcdef";
			for( var i=0; i < 24; i++ )
				nonce += chars.charAt(Math.floor(Math.random() * chars.length));
			return nonce;
		}
		
		function getDigest() {
			return CryptoJS.enc.Base64.stringify(CryptoJS.SHA1(nonce+timestamp+apiSecret));
		}
		var chart1;
		function buildChart(data) {
			chart1 = $('#container1').highcharts({
				credits:{enabled:false},chart: {backgroundColor:'rgba(255,255,255,0)'},title: {text: ''},legend: {enabled: false},
				xAxis: {
					lineColor: '#333',
					tickColor: '#333',
					title: {
						text: ''
					},
					labels: {
         				style: {color:'#c7c7c7'}
					}
				},
				yAxis: {
					gridLineColor: '#444',
					title: {
						text: ''
					},
					labels: {
         				style: {color:'#c7c7c7'}
					}
				},
				series:[
						{
							type:"area",
							/*color:'rgba(255,0,0,1)',*/
							color:Highcharts.theme.colors[0],
							fillOpacity:0.5,
							marker: {enabled:false},
							data: shuffleArray([15915, 17385, 19055, 21205, 23044, 25393, 27935, 30062, 32049,15915, 17385, 19055, 21205, 23044, 25393, 27935, 30062, 32049,15915, 17385, 19055, 21205, 23044, 25393, 27935])	
						},
						{
							type:"column",
							/*color:'rgba(255,0,0,.8)',*/
							color:Highcharts.theme.colors[7],
							fillOpacity:.5,
							data: shuffleArray([15915, 17385, 19055, 21205, 23044, 25393, 27935, 30062, 32049,15915, 17385, 19055, 21205, 23044, 25393, 27935, 30062, 32049,15915, 17385, 19055, 21205, 23044, 25393, 27935]),
							borderWidth:0
						}
				]
			});
			var chart2 = $('#container2').highcharts({
				credits:{enabled:false},chart: {backgroundColor:'rgba(255,255,255,0)'},title: {text: ''},
				series:[
						{
							type:"pie",
							data: [['orgÃ¢nico',64],['direto',45],['bankline',23],['parcerias',87],['facebook',123],['google',94]],
							dataLabels: {
								enabled: false
							},
							borderWidth:0,
							showInLegend: true

						}
				],
				legend:{
					itemStyle: {
						color:"#c7c7c7"	
					},
					itemHoverStyle: {
						color: '#FFF'
					},
				}
			});
		}
		Highcharts.theme = {colors: ["#2b908f", "#90ee7e", "#f45b5b", "#7798BF", "#aaeeee", "#ff0066", "#eeaaee","#55BF3B", "#DF5353", "#7798BF", "#aaeeee"]};
		Highcharts.setOptions(Highcharts.theme);
		
		function shuffleArray(array) {
			for (var i = array.length - 1; i > 0; i--) {
				var j = Math.floor(Math.random() * (i + 1));
				var temp = array[i];
				array[i] = array[j];
				array[j] = temp;
			}
			return array;
		}
		
	</script>
	<style type="text/css">
		body {
			color:#c7c7c7; 
			font-family:'Segoe UI Light','Helvetica Neue Light','Segoe UI','Helvetica Neue',Helvetica,'Trebuchet MS',Verdana,sans-serif;
			background-color:#101214;
			
		}
		
		h5 {padding:8px; margin:0; background-color:#272727; color:#8b8b8b;}
		.chartContainer {
			float:left;
			margin:10px; 
			-webkit-box-shadow:#101214 0 0 8px;
			box-shadow:#101214 0 0 8px;
			/*border:1px solid rgba(255,255,255,.1);*/
			background-color:#2a2a2a;
			/*text-shadow:1px 1px #0e0e0e;*/
		}
		.chartContainer1 {width:50%;}
		.chartContainer2 {width:45%;}
		#container1, #container2 {height:200px;}
	</style>
</head>

<body onload="buildChart(0);">
	<div class="chartContainer chartContainer1">
    	<h5>PROPOSTAS</h5>
    	<div id="container1"></div>
    </div>
	<div class="chartContainer chartContainer2">
    	<h5>ORIGEM</h5>
    	<div id="container2"></div>
    </div>    
</body>
</html>
