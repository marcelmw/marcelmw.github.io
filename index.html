<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Itaucard.Dash</title>
	<!--<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKXW59nZs0VU_GjaizM0YzKQ6HM87mrzs&sensor=true"></script>-->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.min.js"></script>	

	<link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
	<script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha1.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/enc-base64-min.js"></script>
	<script type="text/javascript">
		var apiSecret = "a5af3f5cd5608eb32bab88a6a906ac2a";
       	var stUserName = "marcel.watanabe:Itau";
		var nonce;
		var timestamp;
		var digest;
		var encNonce;
		$(document).ready(function() {
			$('input#btLoad').click(function() {
				nonce = getNonce();
				timestamp = new Date().toISOString().split(".")[0]+"Z";
				digest = getDigest();
				encNonce = btoa(nonce);
				
				$.ajax({
					url:"https://api.omniture.com/admin/1.3/rest/?method=Report.GetRealTimeReport",
					type:"POST",
					data: {
						"reportDescription":{
							"reportSuiteID":"it-receptivo",
							"metrics":[
								{
									"id":"event4"
								}
							],
							"periodMinutes": 20,
							"periodCount": 20,
							"periodOffset": 10
						}
					},
					headers: {"X-WSSE":"UsernameToken Username=\"" + stUserName + "\", PasswordDigest=\"" + digest + "\", Nonce=\"" + encNonce + "\", Created=\"" + timestamp + "\""}
				})
				.done(function( data ) {
					if ( console && console.log ) {
						console.log( "Sample of data:", data );
					}
				});
			});
		});
		
		function getNonce() {
			var nonce = "";
			var chars = "0123456789abcdef";
			for( var i=0; i < 24; i++ )
				nonce += chars.charAt(Math.floor(Math.random() * chars.length));
			return nonce;
		}
		
		function getDigest() {
			return CryptoJS.enc.Base64.stringify(CryptoJS.SHA1(nonce+timestamp+apiSecret));
		}
		
	</script>
	<style type="text/css">

	</style>
</head>

<body>
	<label for="username">Username</label>
	<input type="text" id="username" name="key" />
	<label for="key">Key</label>
	<input type="text" id="key" name="key" />
    <input type="button" value="ok" id="btLoad" />
</body>
</html>
